## 问题分析

通过对代码的详细检查，我发现了导致扫码签到失败的根本原因：

1. **二维码内容解析问题**：
   - 后端生成的二维码内容格式：`activity-${activity.id},signIn-${Date.now()}`
   - 前端模拟生成的二维码内容格式：`activity-${Math.floor(Math.random() * 100) + 1},${Math.random() > 0.5 ? 'signIn' : 'signOut'}`
   - 后端扫码接口解析逻辑：`const [activityIdStr, action] = qrCode.split(',')`

2. **解析逻辑缺陷**：
   - 当二维码内容为 `activity-1,signIn-1234567890` 时，`qrCode.split(',')` 会返回 `["activity-1", "signIn-1234567890"]`
   - 但后端进一步解析 `activityIdStr` 时，只替换了 `activity-` 前缀，得到正确的活动ID
   - 而解析 `action` 时，得到的是 `signIn-1234567890`，而不是预期的 `signIn`
   - 当后端验证 `action === 'signIn'` 或 `action === 'signOut'` 时，验证失败

3. **活动查询失败**：
   - 由于 `action` 验证失败，后端没有正确执行活动查询逻辑
   - 但前端仍然收到了 "活动不存在" 的错误，这可能是因为其他逻辑分支的问题

## 修复方案

### 1. 修改后端二维码解析逻辑

- 更新 `backend/routes/user.js` 中的扫码签到接口，改进二维码内容解析逻辑
- 确保从 `activity-${activity.id},signIn-${Date.now()}` 格式中正确提取活动ID和操作类型

### 2. 优化前端模拟扫码逻辑

- 修改 `src/js/main.js` 中的模拟扫码逻辑，生成符合预期格式的二维码内容
- 确保模拟生成的活动ID是数据库中真实存在的活动ID

### 3. 完善错误处理机制

- 增强后端扫码接口的错误处理，提供更准确的错误信息
- 优化前端错误提示，让用户更容易理解问题所在

## 修复步骤

### 步骤1：修改后端二维码解析逻辑

1. 打开 `backend/routes/user.js` 文件
2. 找到 `router.post('/sign', ...)` 路由（第425行）
3. 修改二维码解析逻辑，正确提取活动ID和操作类型
4. 增强错误处理，提供更准确的错误信息

### 步骤2：优化前端模拟扫码逻辑

1. 打开 `src/js/main.js` 文件
2. 找到 `simulateQRCodeScan` 函数（第5841行）
3. 修改模拟二维码内容生成逻辑，确保活动ID是真实存在的
4. 确保生成的二维码内容格式正确

### 步骤3：测试修复效果

1. 重启后端服务器
2. 测试扫码签到功能，确保在各种场景下都能正常工作
3. 验证错误提示信息是否准确清晰

## 预期效果

修复后，扫码签到功能应该能够：
1. 正确解析包含时间戳的二维码内容
2. 准确验证活动是否存在
3. 正确执行签到或签退操作
4. 提供清晰准确的错误提示
5. 在模拟环境和真实环境下都能正常工作