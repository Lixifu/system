# 个人信息编辑功能实现计划

## 一、功能概述

为所有角色用户页面实现个人信息编辑功能，包括编辑按钮、编辑面板、表单验证、数据提交和结果反馈。

## 二、实现步骤

### 1. 前端UI修改

* **修改** **`renderUserProfile`** **函数**：在个人信息展示区域添加"编辑个人信息"按钮

* **设计编辑面板**：创建模态框或弹出式编辑面板，包含所有可编辑字段

* **添加表单元素**：根据用户模型设计可编辑字段，包括：

  * 姓名（必填）

  * 性别（单选）

  * 年龄（数字）

  * 手机号（唯一，必填）

  * 邮箱（唯一，必填）

### 2. 前端功能实现

* **表单验证**：

  * 姓名必填验证

  * 手机号格式验证

  * 邮箱格式验证

  * 年龄数字验证

* **编辑面板交互**：

  * 点击"编辑"按钮显示面板，填充当前信息

  * 点击"取消"按钮关闭面板，放弃修改

  * 点击"保存"按钮提交表单

* **数据提交**：

  * 使用fetch API提交PUT请求到后端

  * 添加加载状态提示

  * 处理成功/失败反馈

* **数据同步**：

  * 更新localStorage中的用户信息

  * 重新渲染个人中心页面

### 3. 后端API开发

* **创建更新用户信息API**：

  * 路径：`/api/user/profile`

  * 方法：PUT

  * 认证：JWT

  * 请求体：包含可编辑的用户信息字段

  * 响应：更新后的用户信息

* **数据验证**：

  * 验证请求数据格式

  * 检查手机号和邮箱唯一性（排除当前用户）

* **更新逻辑**：

  * 根据用户ID更新数据库记录

  * 返回更新后的用户信息

### 4. 数据库更新

* 确保User模型支持所有可编辑字段

* 验证字段约束（唯一性、必填等）

## 三、技术实现细节

### 1. 前端文件修改

* **`index.html`**：添加编辑模态框HTML结构

* **`main.js`**：

  * 修改`renderUserProfile`函数，添加编辑按钮

  * 添加`initProfileEdit`函数，初始化编辑功能

  * 添加`showEditProfileModal`函数，显示编辑面板

  * 添加`hideEditProfileModal`函数，关闭编辑面板

  * 添加`submitEditProfile`函数，提交表单

  * 添加表单验证函数

### 2. 后端文件修改

* **`routes/user.js`**：添加更新用户信息的路由

* **`controllers/userController.js`**：添加更新用户信息的控制器逻辑

* **`middleware/auth.js`**：确保API受JWT保护

### 3. 表单验证规则

* 姓名：必填，长度1-50字符

* 手机号：必填，11位数字

* 邮箱：必填，符合邮箱格式

* 年龄：非必填，1-150之间的数字

* 性别：非必填，只能是male/female/other

### 4. 状态反馈

* 加载状态：显示"保存中..."提示

* 成功状态：显示"保存成功"提示

* 失败状态：显示具体错误信息

## 四、测试要点

1. 编辑功能是否在所有角色页面正常显示
2. 表单验证是否有效
3. 保存和取消按钮是否正常工作
4. 数据是否正确同步到后端
5. 页面是否正确刷新
6. 错误提示是否清晰
7. 在不同浏览器中的兼容性

## 五、代码规范

* 遵循现有代码风格

* 保持UI一致性

* 添加适当的注释

* 处理所有可能的错误情况

* 确保代码可维护性

## 六、预期效果

* 用户可在个人中心轻松编辑个人信息

* 编辑过程流畅，有清晰的状态反馈

* 数据安全，验证严格

* 界面美观，符合现有设计风格

* 功能稳定，无明显bug

