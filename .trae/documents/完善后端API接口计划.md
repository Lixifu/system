# 完善后端API接口计划

## 1. 实现缺少的API接口

### 1.1 活动签到二维码管理
- **功能描述**：生成和更新活动签到二维码
- **API端点**：
  - `POST /api/activities/:id/qrcode` - 生成活动签到二维码
  - `PUT /api/activities/:id/qrcode` - 更新活动签到二维码
- **实现细节**：
  - 使用第三方库（如qrcode）生成二维码
  - 将二维码存储为图片文件，或直接返回二维码数据
  - 更新Activity模型的qrCode字段

### 1.2 活动总结功能
- **功能描述**：组织方提交活动总结
- **API端点**：
  - `POST /api/activities/:id/summary` - 提交活动总结
- **实现细节**：
  - 在Activity模型中添加summary字段
  - 实现活动总结的提交和更新
  - 支持富文本格式的总结内容

### 1.3 消息群发功能
- **功能描述**：组织方给活动参与者群发消息
- **API端点**：
  - `POST /api/activities/:id/message` - 消息群发
- **实现细节**：
  - 使用Notification模型发送消息
  - 支持按状态过滤参与者
  - 支持批量发送消息

### 1.4 长期项目管理
- **功能描述**：支持创建和管理长期项目
- **API端点**：
  - `GET /api/activities/long-term` - 获取长期项目列表
  - `POST /api/activities/long-term` - 创建长期项目
  - `PUT /api/activities/long-term/:id` - 更新长期项目
  - `DELETE /api/activities/long-term/:id` - 删除长期项目
- **实现细节**：
  - 在Activity模型中添加isLongTerm字段
  - 支持设置重复规则
  - 支持批量生成活动实例

## 2. 完善现有API接口

### 2.1 志愿履历管理
- **功能描述**：完善志愿履历管理，添加荣誉证书、评价和勋章功能
- **API端点**：
  - `GET /api/user/resume` - 获取志愿者履历
  - `POST /api/user/resume/certificates` - 添加荣誉证书
  - `GET /api/user/medals` - 获取志愿者勋章
- **实现细节**：
  - 关联User、Medal和UserMedal模型
  - 实现勋章的获取和展示
  - 实现荣誉证书的上传和管理

### 2.2 搜索功能优化
- **功能描述**：优化活动和培训的搜索功能
- **API端点**：
  - `GET /api/activities/search` - 搜索活动
  - `GET /api/trainings/search` - 搜索培训
- **实现细节**：
  - 支持多字段组合搜索
  - 支持按关键词搜索
  - 支持按时间范围搜索

### 2.3 分页功能
- **功能描述**：为所有列表接口添加分页支持
- **API端点**：
  - 所有列表查询接口
- **实现细节**：
  - 添加limit和offset参数
  - 返回总数、当前页数、每页数量等分页信息
  - 优化数据库查询性能

## 3. 提高代码质量

### 3.1 添加输入验证
- **功能描述**：为所有API接口添加输入验证
- **实现细节**：
  - 使用express-validator库实现输入验证
  - 为每个API端点添加验证规则
  - 统一错误处理格式

### 3.2 完善错误处理
- **功能描述**：统一错误处理格式，提供更详细的错误信息
- **实现细节**：
  - 创建统一的错误处理中间件
  - 定义标准的错误响应格式
  - 提供详细的错误信息

### 3.3 添加日志记录
- **功能描述**：为关键操作添加日志记录
- **实现细节**：
  - 使用winston或morgan库实现日志记录
  - 记录API请求和响应信息
  - 记录关键操作和错误信息

### 3.4 添加缓存机制
- **功能描述**：对频繁访问的数据添加缓存
- **实现细节**：
  - 使用redis或memory-cache库实现缓存
  - 为活动列表、培训列表等频繁访问的数据添加缓存
  - 设置合理的缓存过期时间

### 3.5 完善测试用例
- **功能描述**：为API接口添加单元测试和集成测试
- **实现细节**：
  - 使用jest或mocha库实现测试
  - 为每个API端点添加测试用例
  - 测试各种边界情况

## 4. 实现步骤

1. **实现缺少的API接口**
   - 活动签到二维码管理
   - 活动总结功能
   - 消息群发功能
   - 长期项目管理

2. **完善现有API接口**
   - 志愿履历管理
   - 搜索功能优化
   - 分页功能

3. **提高代码质量**
   - 添加输入验证
   - 完善错误处理
   - 添加日志记录
   - 添加缓存机制
   - 完善测试用例

通过以上计划，我将完善后端API接口，提高代码质量，确保系统能够满足项目需求。